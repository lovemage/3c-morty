<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å» å•†æ•´åˆç¯„ä¾‹ - ECPay å››æ–¹é‡‘æµ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
            border-radius: 10px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .card-header {
            background: #3498db;
            color: white;
            padding: 20px;
            font-weight: bold;
            font-size: 18px;
        }
        
        .card-body {
            padding: 30px;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            position: relative;
        }
        
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4a5568;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #2d3748;
        }
        
        .step {
            background: #ecf0f1;
            border-left: 5px solid #3498db;
            padding: 20px;
            margin: 20px 0;
        }
        
        .step h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        .language-tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }
        
        .tab {
            background: #f8f9fa;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .tab.active {
            background: white;
            border-bottom-color: #3498db;
            color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸª å» å•†æ•´åˆç¯„ä¾‹</h1>
            <p>ECPay å››æ–¹é‡‘æµ API æ•´åˆæŒ‡å—</p>
        </div>
        
        <!-- API åŸºæœ¬èªªæ˜ -->
        <div class="card">
            <div class="card-header">ğŸ“‹ API åŸºæœ¬è³‡è¨Š</div>
            <div class="card-body">
                <div class="grid">
                    <div>
                        <h4>API ç«¯é»</h4>
                        <code>https://corba3c-production.up.railway.app/api/third-party/barcode/create</code>
                        
                        <h4 style="margin-top: 20px;">é©—è­‰æ–¹å¼</h4>
                        <p>è«‹åœ¨ HTTP Header ä¸­åŠ å…¥æ‚¨çš„ API Keyï¼š</p>
                        <div class="code-block">
                            X-API-KEY: your-api-key-here
                        </div>
                    </div>
                    <div>
                        <h4>è«‹æ±‚åƒæ•¸</h4>
                        <ul>
                            <li><strong>amount</strong> (å¿…å¡«): ä»˜æ¬¾é‡‘é¡ (1-6000)</li>
                            <li><strong>client_order_id</strong> (å¿…å¡«): æ‚¨çš„è¨‚å–®ç·¨è™Ÿ</li>
                            <li><strong>callback_url</strong> (é¸å¡«): ä»˜æ¬¾å®Œæˆé€šçŸ¥URL</li>
                        </ul>
                        
                        <h4 style="margin-top: 20px;">å›æ‡‰æ ¼å¼</h4>
                        <p>æˆåŠŸæ™‚æœƒè¿”å› ECPay è¡¨å–®è³‡æ–™ï¼Œç”¨æ–¼è·³è½‰åˆ°æ”¶éŠ€å°</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ•´åˆæ­¥é©Ÿ -->
        <div class="card">
            <div class="card-header">ğŸš€ æ•´åˆæ­¥é©Ÿ</div>
            <div class="card-body">
                <div class="step">
                    <h4>æ­¥é©Ÿ 1: å‘¼å« API å»ºç«‹è¨‚å–®</h4>
                    <p>å‘æˆ‘å€‘çš„ API ç™¼é€ POST è«‹æ±‚ï¼Œå»ºç«‹ä»˜æ¬¾è¨‚å–®</p>
                </div>
                
                <div class="step">
                    <h4>æ­¥é©Ÿ 2: å–å¾— ECPay è¡¨å–®è³‡æ–™</h4>
                    <p>API æœƒå›å‚³ <code>ecpay_form</code> ç‰©ä»¶ï¼ŒåŒ…å«è·³è½‰æ‰€éœ€çš„æ‰€æœ‰è³‡æ–™</p>
                </div>
                
                <div class="step">
                    <h4>æ­¥é©Ÿ 3: å»ºç«‹ HTML è¡¨å–®ä¸¦è‡ªå‹•æäº¤</h4>
                    <p>ä½¿ç”¨å›å‚³çš„è³‡æ–™å»ºç«‹è¡¨å–®ï¼Œè·³è½‰åˆ° ECPay æ”¶éŠ€å°</p>
                </div>
                
                <div class="step">
                    <h4>æ­¥é©Ÿ 4: ç”¨æˆ¶å®Œæˆä»˜æ¬¾</h4>
                    <p>ç”¨æˆ¶åœ¨ ECPay é é¢å®Œæˆæ¢ç¢¼ä»˜æ¬¾ï¼Œç³»çµ±è‡ªå‹•é€šçŸ¥æ‚¨</p>
                </div>
            </div>
        </div>
        
        <!-- ç¨‹å¼ç¢¼ç¯„ä¾‹ -->
        <div class="card">
            <div class="card-header">ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹</div>
            <div class="card-body">
                <div class="language-tabs">
                    <button class="tab active" onclick="showTab('javascript')">JavaScript</button>
                    <button class="tab" onclick="showTab('php')">PHP</button>
                    <button class="tab" onclick="showTab('python')">Python</button>
                </div>
                
                <!-- JavaScript ç¯„ä¾‹ -->
                <div id="javascript" class="tab-content active">
                    <h4>1. å»ºç«‹è¨‚å–®</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<pre>async function createPayment(amount, orderId) {
    try {
        const response = await fetch('https://corba3c-production.up.railway.app/api/third-party/barcode/create', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-API-KEY': 'your-api-key-here'
            },
            body: JSON.stringify({
                amount: amount,
                client_order_id: orderId,
                callback_url: 'https://your-site.com/webhook'
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            // å–å¾— ECPay è¡¨å–®è³‡æ–™
            redirectToECPay(data.data.ecpay_form);
        } else {
            console.error('å»ºç«‹è¨‚å–®å¤±æ•—:', data.message);
        }
    } catch (error) {
        console.error('API å‘¼å«å¤±æ•—:', error);
    }
}</pre>
                    </div>
                    
                    <h4>2. è·³è½‰åˆ° ECPay</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<pre>function redirectToECPay(ecpayForm) {
    // å»ºç«‹éš±è—è¡¨å–®
    const form = document.createElement('form');
    form.method = ecpayForm.method;
    form.action = ecpayForm.action;
    form.style.display = 'none';
    
    // åŠ å…¥æ‰€æœ‰åƒæ•¸ä½œç‚ºéš±è—æ¬„ä½
    Object.entries(ecpayForm.params).forEach(([key, value]) => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = key;
        input.value = value;
        form.appendChild(input);
    });
    
    // æäº¤è¡¨å–®
    document.body.appendChild(form);
    form.submit();
}</pre>
                    </div>
                </div>
                
                <!-- PHP ç¯„ä¾‹ -->
                <div id="php" class="tab-content">
                    <h4>1. å»ºç«‹è¨‚å–®</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<pre>&lt;?php
function createPayment($amount, $orderId) {
    $url = 'https://corba3c-production.up.railway.app/api/third-party/barcode/create';
    
    $data = [
        'amount' => $amount,
        'client_order_id' => $orderId,
        'callback_url' => 'https://your-site.com/webhook.php'
    ];
    
    $options = [
        'http' => [
            'method' => 'POST',
            'header' => [
                'Content-Type: application/json',
                'X-API-KEY: your-api-key-here'
            ],
            'content' => json_encode($data)
        ]
    ];
    
    $context = stream_context_create($options);
    $response = file_get_contents($url, false, $context);
    $result = json_decode($response, true);
    
    if ($result['success']) {
        return $result['data'];
    } else {
        throw new Exception('å»ºç«‹è¨‚å–®å¤±æ•—: ' . $result['message']);
    }
}
?&gt;</pre>
                    </div>
                    
                    <h4>2. ç”¢ç”Ÿ ECPay è¡¨å–®</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<pre>&lt;?php
function generateECPayForm($ecpayForm) {
    $html = '&lt;form id="ecpayForm" method="' . $ecpayForm['method'] . '" action="' . $ecpayForm['action'] . '"&gt;';
    
    foreach ($ecpayForm['params'] as $key => $value) {
        $html .= '&lt;input type="hidden" name="' . $key . '" value="' . $value . '"&gt;';
    }
    
    $html .= '&lt;/form&gt;';
    $html .= '&lt;script&gt;document.getElementById("ecpayForm").submit();&lt;/script&gt;';
    
    return $html;
}

// ä½¿ç”¨æ–¹å¼
try {
    $paymentData = createPayment(299, 'order_' . time());
    echo generateECPayForm($paymentData['ecpay_form']);
} catch (Exception $e) {
    echo 'éŒ¯èª¤: ' . $e->getMessage();
}
?&gt;</pre>
                    </div>
                </div>
                
                <!-- Python ç¯„ä¾‹ -->
                <div id="python" class="tab-content">
                    <h4>1. å»ºç«‹è¨‚å–®</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<pre>import requests
import json

def create_payment(amount, order_id):
    url = 'https://corba3c-production.up.railway.app/api/third-party/barcode/create'
    
    headers = {
        'Content-Type': 'application/json',
        'X-API-KEY': 'your-api-key-here'
    }
    
    data = {
        'amount': amount,
        'client_order_id': order_id,
        'callback_url': 'https://your-site.com/webhook'
    }
    
    response = requests.post(url, headers=headers, json=data)
    result = response.json()
    
    if result['success']:
        return result['data']
    else:
        raise Exception(f"å»ºç«‹è¨‚å–®å¤±æ•—: {result['message']}")

# ä½¿ç”¨æ–¹å¼
try:
    payment_data = create_payment(299, f"order_{int(time.time())}")
    ecpay_form = payment_data['ecpay_form']
    print("ECPay è¡¨å–®è³‡æ–™:", ecpay_form)
except Exception as e:
    print("éŒ¯èª¤:", str(e))</pre>
                    </div>
                    
                    <h4>2. Flask ç¯„ä¾‹ (ç”¢ç”Ÿè·³è½‰é é¢)</h4>
                    <div class="code-block">
                        <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<pre>from flask import Flask, render_template_string

def generate_ecpay_form(ecpay_form):
    template = '''
    &lt;html&gt;
    &lt;body&gt;
        &lt;form id="ecpayForm" method="{{ method }}" action="{{ action }}"&gt;
            {% for key, value in params.items() %}
            &lt;input type="hidden" name="{{ key }}" value="{{ value }}"&gt;
            {% endfor %}
        &lt;/form&gt;
        &lt;script&gt;
            document.getElementById("ecpayForm").submit();
        &lt;/script&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    '''
    
    return render_template_string(template, 
                                method=ecpay_form['method'],
                                action=ecpay_form['action'],
                                params=ecpay_form['params'])

# åœ¨ Flask è·¯ç”±ä¸­ä½¿ç”¨
@app.route('/checkout')
def checkout():
    try:
        payment_data = create_payment(299, f"order_{int(time.time())}")
        return generate_ecpay_form(payment_data['ecpay_form'])
    except Exception as e:
        return f"éŒ¯èª¤: {str(e)}"</pre>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ³¨æ„äº‹é … -->
        <div class="card">
            <div class="card-header">âš ï¸ é‡è¦æ³¨æ„äº‹é …</div>
            <div class="card-body">
                <div class="warning">
                    <h4>å®‰å…¨æ€§æé†’</h4>
                    <ul>
                        <li>è«‹å¦¥å–„ä¿ç®¡æ‚¨çš„ API Keyï¼Œä¸è¦åœ¨å‰ç«¯ç¨‹å¼ç¢¼ä¸­æš´éœ²</li>
                        <li>å»ºè­°å¯¦ä½œ IP ç™½åå–®é™åˆ¶</li>
                        <li>callback_url å»ºè­°ä½¿ç”¨ HTTPS</li>
                    </ul>
                </div>
                
                <div class="success">
                    <h4>æœ€ä½³å¯¦ä½œ</h4>
                    <ul>
                        <li>åœ¨ç”¨æˆ¶é»æ“Šã€Œçµå¸³ã€æ™‚æ‰å‘¼å« API</li>
                        <li>ç‚ºé¿å…é‡è¤‡è¨‚å–®ï¼Œæ¯å€‹ client_order_id æ‡‰è©²æ˜¯å”¯ä¸€çš„</li>
                        <li>å»ºè­°åœ¨è·³è½‰å‰é¡¯ç¤ºè¼‰å…¥æç¤º</li>
                        <li>å¯¦ä½œä»˜æ¬¾å®Œæˆå¾Œçš„ç‹€æ…‹æŸ¥è©¢æ©Ÿåˆ¶</li>
                    </ul>
                </div>
                
                <h4>æ¸¬è©¦ç’°å¢ƒ</h4>
                <p>æ‚¨å¯ä»¥ä½¿ç”¨æˆ‘å€‘æä¾›çš„æ¸¬è©¦é é¢ä¾†é©—è­‰æ•´åˆï¼š</p>
                <div class="code-block">
                    <a href="ecpay-checkout-test.html" target="_blank" style="color: #61dafb; text-decoration: none;">
                        ğŸ§ª é–‹å•Ÿ ECPay è·³è½‰æ¸¬è©¦é é¢
                    </a>
                </div>
            </div>
        </div>
        
        <!-- API å›æ‡‰ç¯„ä¾‹ -->
        <div class="card">
            <div class="card-header">ğŸ“¤ API å›æ‡‰ç¯„ä¾‹</div>
            <div class="card-body">
                <h4>æˆåŠŸå›æ‡‰</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<pre>{
  "success": true,
  "data": {
    "order_id": 27,
    "client_order_id": "test_order_1755514318",
    "merchant_trade_no": "TPA1755514321045027",
    "trade_no": null,
    "store_type": "7ELEVEN",
    "amount": 299,
    "expire_date": "2025-08-25T10:52:01.045Z",
    "customer_info_url": "https://corba3c-production.up.railway.app/customer-info/27",
    "barcode_status": "generated",
    "payment_method": "ecpay_redirect",
    "ecpay_form": {
      "action": "https://payment.ecpay.com.tw/Cashier/AioCheckOut/V5",
      "method": "POST",
      "params": {
        "MerchantID": "3466445",
        "MerchantTradeNo": "TPA1755514321045027",
        "MerchantTradeDate": "2025/08/18 10:52:01",
        "PaymentType": "aio",
        "TotalAmount": 299,
        "TradeDesc": "7ELEVENä¾¿åˆ©åº—æ¢ç¢¼ä»˜æ¬¾",
        "ItemName": "3Cå•†å“ä¸€çµ„ - NT$299",
        "ReturnURL": "https://corba3c-production.up.railway.app/api/third-party/ecpay/callback",
        "ChoosePayment": "BARCODE",
        "EncryptType": 1,
        "StoreExpireDate": 7,
        "PaymentInfoURL": "https://corba3c-production.up.railway.app/api/third-party/ecpay/payment-info",
        "Desc_1": "7-ELEVEN",
        "CheckMacValue": "A7617606192BDF2D8A4DA34A03166BD069260CF9B61DD97C11F0076A2259C586"
      }
    },
    "message": "è¨‚å–®å»ºç«‹æˆåŠŸï¼Œè«‹ä½¿ç”¨ecpay_formå»ºç«‹POSTè¡¨å–®è·³è½‰åˆ°ECPayé é¢é€²è¡Œæ¢ç¢¼ä»˜æ¬¾",
    "integration_instructions": [
      "ä½¿ç”¨ecpay_form.actionä½œç‚ºè¡¨å–®çš„action URL",
      "ä½¿ç”¨ecpay_form.method (POST)ä½œç‚ºè¡¨å–®æ–¹æ³•", 
      "å°‡ecpay_form.paramsä¸­çš„æ‰€æœ‰åƒæ•¸ä½œç‚ºéš±è—æ¬„ä½æ·»åŠ åˆ°è¡¨å–®",
      "æäº¤è¡¨å–®å°‡è·³è½‰åˆ°ECPayæ¢ç¢¼é é¢",
      "ç”¨æˆ¶å®Œæˆä»˜æ¬¾å¾Œï¼Œç³»çµ±æœƒæ”¶åˆ°ä»˜æ¬¾é€šçŸ¥"
    ]
  }
}</pre>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function showTab(language) {
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰ tab çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹
            document.getElementById(language).classList.add('active');
            
            // è¨­ç½®é¸ä¸­çš„ tab
            event.target.classList.add('active');
        }
        
        function copyCode(button) {
            const codeBlock = button.parentElement.querySelector('pre');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'å·²è¤‡è£½!';
                setTimeout(() => {
                    button.textContent = 'è¤‡è£½';
                }, 2000);
            });
        }
    </script>
</body>
</html>